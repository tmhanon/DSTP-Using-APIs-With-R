<!DOCTYPE html>
<html lang="en"><head>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-html/tabby.min.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.7.32">

  <meta name="author" content="Tristan Hanon">
  <meta name="dcterms.date" content="2026-02-05">
  <title>Working with APIs in R</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    html { -webkit-text-size-adjust: 100%; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="site_libs/revealjs/dist/theme/quarto-37d0252593370fa6a2d048460841a4c0.css">
  <link href="site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  <link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">

  <script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>

</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" data-background-color="#f7f1e0" data-background-image="images/AMS-Title-Slide.png" data-background-size="contain" class="quarto-title-block">
  <h1 class="title">Working with APIs in R</h1>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Tristan Hanon 
</div>
<div class="quarto-title-author-email">
<a href="mailto:tristan.hanon@usda.gov">tristan.hanon@usda.gov</a>
</div>
        <p class="quarto-title-affiliation">
            AMS Dairy Program
          </p>
    </div>
</div>

  <p class="date">February 5, 2026</p>
</section>
<section id="my-background" class="slide level2">
<h2>My Background</h2>
<ul>
<li>Agricultural Economist in AMS Dairy Program</li>
<li>Started with AMS in 2022</li>
<li>Ph.D.&nbsp;in Agricultural and Resource Economics from UC Davis</li>
</ul>
<p><span class="fragment">Started working in R in grad school because I did not want to rely on proprietary software anymore</span> <span class="fragment">(in other words, I was cheap and broke).</span></p>
<p><span class="fragment">I have not always been good about using APIs, so I started trying to prioritize them in my work at USDA.</span></p>
<aside class="notes">
<p>I am an agricultural economist with the AMS Dairy Program. I provide analysis to support the Federal Milk Marketing Orders, work with Commodity Procurement to support their purchases of dairy products, and contribute to the WASDE projections for dairy.</p>
<p>I started with AMS in 2022, but previously had a stint with NASS when I was in undergrad. I also worked for the Congressional Budget Office between undergrad and grad school, so I am no stranger to government work.</p>
<p>I received my masters and Ph.D.&nbsp;from UC Davis.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="assumptions" class="slide level2">
<h2>Assumptions</h2>
<aside class="notes">
<p>To make this seminar as accessible as possible, I tried to make a limited set of assumptions about what knowledge you all have coming into this. However, I do want to start by assuming some knowledge at least.</p>
<p>First, I think it is safe to assume some familiarity with the <code>tidyverse</code> since it is used extensively in the coursework so far. In general, I will not be explaining <code>tidyverse</code> functions, though I will try to provide links to their documentation in the slides.</p>
<p>I will also be using the pipe extensively. I still tend to use the <code>tidyverse</code> pipe more often than the base pipe, but I will use both at different points in the presentation.</p>
<p>I am going to discuss functions in depth (and even get into building some functions later on), so I am assuming you will know what I mean when I talk about a functions arguments and other aspects of functions.</p>
<p>Finally, this may sound a bit silly, but I need to assume some understanding of how the internet works. APIs are inherently part of the web architecture, so working with APIs involves a lot of concepts associated with the internet. This is still going to be fairly basic though, like the idea that when you access a website there is communication between a client (your computer) and a server.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<p>I am making a (limited) set of assumptions about your knowledge coming into this seminar:</p>
<ul>
<li class="fragment">Familiarity with <code>tidyverse</code> functions and the pipe (both <code>%&gt;%</code> and <code>|&gt;</code>)</li>
<li class="fragment">Familiarity with R object and data types (e.g., string, list, vector)</li>
<li class="fragment">Understanding of function terminology (e.g., what an argument is)</li>
<li class="fragment">Some understanding of how the internet works</li>
</ul>
<div class="fragment">
<p>Whenever I use functions from packages outside of the <code>tidyverse</code>, I will specify them using the <code>package_name::function_name()</code> syntax to make it clear where they come from.</p>
</div>
<div class="fragment">
<p>Therefore, I’m only going to load one package to use in this presentation:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section id="topics-covered" class="slide level2 inverse">
<h2>Topics Covered</h2>
<ul>
<li class="fragment">Definitions: What even is an API?</li>
<li class="fragment">Example API: Mandatory Price Reporting Data</li>
<li class="fragment">How to interact with APIs using R and the <code>httr2</code> package</li>
<li class="fragment">Building an API Function</li>
<li class="fragment">API Authentication</li>
<li class="fragment">Example API: My Market News</li>
</ul>
</section>
<section>
<section id="definitions" class="title-slide slide level1 inverse">
<h1>Definitions</h1>

</section>
<section id="what-is-an-api" class="slide level2">
<h2>What is an API?</h2>
<aside class="notes">
<p>The term API can also be used to refer to any means of interacting with a piece of software. For example, the way a specific R package interacts with R could be describes as the package’s API (one piece of software communicating with another).</p>
<p>In data science, we typically mean <em>web API</em> when we say <em>API</em>. A server-side web API will have a set of defined <em>endpoints</em></p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<p>API stands for <span class="hl-lightblue-lightgreen"><strong><em>Application Programming Interface</em></strong></span>.</p>
<div class="fragment">
<p>As a general term, it is a framework which connects computers or software together.</p>
</div>
<div class="fragment">
<p>In a data science context, typically refers to a system allowing access to data via a specialized request-response framework.</p>
</div>
<div class="fragment">
<p>A more precise definition would be to refer to the latter as <em>web APIs</em>, but they are often simply called APIs.</p>
</div>
</section>
<section id="web-apis" class="slide level2">
<h2>Web APIs</h2>
<aside class="notes">
<p>The most common architecture or design for web APIs is called <em>REST</em>, which stands for Representational State Transfer. An API which conforms to the REST guidelines is often referred to as <em>RESTful</em>. I’m going to describe this style of API since it is what I am familiar with (and likely what you will run into in the wild), but be aware there are other styles of APIs for specific use cases.</p>
<p>As an aside, HTTP (hypertext transfer protocol) is also a very general term that describes a request-response framework in a client-server model. Any time you utilize a web browser to access a website, you are sending an HTTP request to a server and receiving a response.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>

<img data-src="images/rest-api.png" class="quarto-figure quarto-figure-center r-stretch"><p>A <span class="hl-lightblue-lightgreen"><strong><em>web API</em></strong></span> will have a set of defined <span class="hl-lightblue-lightgreen"><strong><em>endpoints</em></strong></span> that a user can access with a correctly-formatted <em>request</em> and receive a <em>response</em>.</p>
<div class="fragment">
<p><span class="hl-lightblue-lightgreen"><strong><em>Requests</em></strong></span> are typically formatted using <span class="hl-lightblue-lightgreen"><strong><em>HTTP</em></strong></span> and use one of a set of <em>verbs</em>, the most common being <code>GET</code> and <code>POST</code>. To access data, <code>GET</code> is the verb to use.</p>
</div>
<div class="fragment">
<p><span class="hl-lightblue-lightgreen"><strong><em>Responses</em></strong></span> can be in the form of JSON, XML, HTML, or plain text data, though JSON is the most common.</p>
</div>
</section>
<section id="anatomy-of-an-api-call" class="slide level2">
<h2>Anatomy of an API Call</h2>
<p>Let’s look at an API call some of us have seen already (from Intermediate Assignments 1 and 2):</p>
<div class="center-text">
<p><span class="fragment hl-brown" data-fragment-index="0"><code>https://api.census.gov/data</code></span><span class="fragment hl-brown" data-fragment-index="1"><code>/2020/dec/pl</code></span><span class="fragment hl-brown" data-fragment-index="2"><code>?get=P1_001N&amp;for=county</code></span></p>
</div>
<div class="fragment" data-fragment-index="0">
<p>The first part is the base URL used across the Census API.</p>
</div>
<div class="fragment" data-fragment-index="1">
<p>The next part defines the <strong>API endpoint</strong>: <code>/2020/dec</code> is pointing the the 2020 Decennial Census, within which <code>/pl</code> specifies the specific dataset. In this case, the full endpoint points to the redistricting data from the 2020 Decennial Census.</p>
</div>
<div class="fragment" data-fragment-index="2">
<p>Everything after the <code>?</code> defines the query parameters:</p>
</div>
<div class="fragment smaller-bullets" data-fragment-index="2">
<ul>
<li><code>get=P1_001N</code> says we are using a <code>GET</code> HTTP action and requesting the <code>P1_001N</code> variable (total population).</li>
<li><code>&amp;</code> is used to separate query parameters if multiple are specified.</li>
<li><code>for=county</code> specifies the geography level, i.e.&nbsp;county-level total population. This could be changed to <code>for=state</code> to return state-level population, or another specific named geography.</li>
</ul>
</div>
</section>
<section id="why-use-an-api" class="slide level2">
<h2>Why use an API?</h2>
<p>Using a web API requires some extra work. What is the benefit of that extra effort?</p>
<ul>
<li class="fragment">Regularly updated data: If you are using high-frequency data, using an API ensures you always have access to the most up-to-date data.</li>
<li class="fragment">Reproducibility: Know what you are getting each time the code is run. Ensure your collaborators get the same results as you.</li>
<li class="fragment">Reusability: In many cases, once the code is written it can be used over and over (especially if you build a function).</li>
<li class="fragment">Automation: Using an API can remove manual processes, such as downloading data.</li>
</ul>
</section></section>
<section>
<section id="exploring-a-scenario" class="title-slide slide level1 inverse">
<h1>Exploring a Scenario</h1>

</section>
<section id="mandatory-price-reporting-data" class="slide level2">
<h2>Mandatory Price Reporting Data</h2>
<div class="columns">
<div class="column" style="width:60%;">
<p><span class="fragment" data-fragment-index="0">Suppose we need to access data from the Dairy Product Mandatory Reporting Program (DPMRP).</span></p>
<p><span class="fragment" data-fragment-index="1">This program collects prices and sales volumes for butter, cheese, dry whey, and nonfat dry milk.</span></p>
<p><span class="fragment" data-fragment-index="2">These data are accessible through the <a href="https://mpr.datamart.ams.usda.gov/"><strong>Datamart</strong></a> website (as are data from other mandatory reporting programs).</span></p>
</div><div class="column" style="width:40%;">
<p><span class="fragment" data-fragment-index="2"><a href="https://mpr.datamart.ams.usda.gov/"><img data-src="images/Datamart-Main-Page.png" alt="Main page of Datamart website"></a></span></p>
</div></div>
<aside class="notes">
<p>As an example, let’s look at the data collected through the Dairy Product Mandatory Reporting Program. Obviously, as someone working in Dairy Program, these are data I use regularly, but they provide a good example of public USDA data that are accessible via API.</p>
<p>(Click through to the Datamart website and walk through the steps of accessing data that way).</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="datamart-api-user-guide" class="slide level2">
<h2>Datamart API User Guide</h2>
<aside class="notes">
<p>It is <em>always</em> a good idea to review any available API documentation.</p>
<p>The Datamart API user guide primarily covers accessing the API using Excel or Postman (another piece of software specifically focused on working with APIs). But it also give us a couple of example URLs that we can use to learn more about how to access data through the API.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<p>Datamart data are accessible through an API, and the main Datamart webpage has a link to a <a href="https://mpr.datamart.ams.usda.gov/LMPRS-API-User-Guide.pdf">user guide</a> for that API.</p>

<img data-src="images/Datamart-User-Guide-NDPSR-URLs.png" class="quarto-figure quarto-figure-center r-stretch" style="width:80.0%" alt="Screenshot from LMPRS API User Guide showing URLs to access NDSPR prices and sales data."><div class="fragment">
<p>The following URL provides access to butter prices and sales data:</p>
<p><a href="https://mpr.datamart.ams.usda.gov/services/v1.1/reports/2993/Butter%20Prices%20and%20Sales" style="font-size: 0.8em"><code>https://mpr.datamart.ams.usda.gov/services/v1.1/reports/2993/Butter%20Prices%20and%20Sales</code></a></p>
</div>
<div class="fragment">
<p><span class="hl-lightblue-lightgreen"><strong><em>But how do we access these data from within R?</em></strong></span></p>
</div>
</section></section>
<section>
<section id="introduction-to-httr2" class="title-slide slide level1 inverse">
<h1>Introduction to <code>httr2</code></h1>

</section>
<section id="httr2" class="slide level2" data-auto-animate="true">
<h2 data-id="quarto-animate-title"><code>httr2</code></h2>
<aside class="notes">
<p><code>httr2</code>, pronounced “hitter 2”, is a package developed by Hadley Wickham, the mastermind behind the <code>tidyverse</code>.</p>
<p>As the name suggests, it is a “sequel” to the package <code>httr</code>, which is also widely used for API access in R.</p>
<p>However, <code>httr2</code> has a lot of newer features that expand on the abilities of <code>httr</code>. These features also make it easier to build functions and packages to access APIs.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<div class="columns">
<div class="column" style="width:70%;">
<p><a href="https://httr2.r-lib.org/index.html"><code>httr2</code></a> is a package developed by Hadley Wickham, the mastermind behind the <code>tidyverse</code>, which provides a robust framework for building and executing HTTP requests.</p>
<p>First released in 2021 (so, relatively new in terms of R packages).</p>
</div><div class="column" style="width:30%;">
<p><a href="https://httr2.r-lib.org/index.html"><img data-src="images/httr2-logo.png" alt="Logo for httr2 package"></a></p>
</div></div>
</section>
<section id="httr2-1" class="slide level2" data-auto-animate="true">
<h2 data-id="quarto-animate-title"><code>httr2</code></h2>
<div class="columns">
<div class="column" style="width:70%;">
<p><a href="https://httr2.r-lib.org/index.html"><code>httr2</code></a> is a package developed by Hadley Wickham, the mastermind behind the <code>tidyverse</code>, which provides a robust framework for building and executing HTTP requests.</p>
<p>First released in 2021 (so, relatively new in terms of R packages).</p>
</div><div class="column" style="width:30%;">
<p><a href="https://httr2.r-lib.org/index.html"><img data-src="images/httr2-logo.png" alt="Logo for httr2 package"></a></p>
</div></div>
<p><span style="font-size: 1.2em"><strong><em>Advantages:</em></strong></span></p>
<ul>
<li class="fragment">Creates explicit <strong><em>request</em></strong> objects instead of executing a request automatically.</li>
<li class="fragment">Allows piping of <strong><em>request</em></strong> and <strong><em>response</em></strong> objects.</li>
<li class="fragment">Securely handles secrets/credentials for accessing APIs.</li>
</ul>
</section>
<section id="httr2-2" class="slide level2" data-auto-animate="true">
<h2 data-id="quarto-animate-title"><code>httr2</code></h2>
<aside class="notes">
<p>There are a couple downsides I see to using <code>httr2</code>. First, it is a bit more complex than <code>httr</code> and therefore has a bit more of a learning curve. However, I think taking the time to learn its features is more beneficial in the long run.</p>
<p>Second, it is still developing, and occasionally changes come along that can break existing code. This happened to me at one point, and I’ll get into exactly what happened a little later.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<div class="columns">
<div class="column" style="width:70%;">
<p><a href="https://httr2.r-lib.org/index.html"><code>httr2</code></a> is a package developed by Hadley Wickham, the mastermind behind the <code>tidyverse</code>, which provides a robust framework for building and executing HTTP requests.</p>
<p>First released in 2021 (so, relatively new in terms of R packages).</p>
</div><div class="column" style="width:30%;">
<p><a href="https://httr2.r-lib.org/index.html"><img data-src="images/httr2-logo.png" alt="Logo for httr2 package"></a></p>
</div></div>
<p><span style="font-size: 1.2em"><strong><em>Disadvantages:</em></strong></span></p>
<ul>
<li class="fragment">More complex than alternative options (namely <code>httr</code>).</li>
<li class="fragment">Still in development… can occasionally break your code.</li>
</ul>
</section>
<section id="creating-a-httr2-request" class="slide level2" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Creating a <code>httr2</code> Request</h2>
<aside class="notes">
<p>The first step is to create a <code>request</code> object.</p>
<p>A <code>httr2_request</code> object is technically a list object containing a variety of information (most of which is actually empty in a simple case like this).</p>
<p>Printing the <code>req</code> object gives us a bit of information about what it contains, including the URL.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<p>A <span class="hl-lightblue-lightgreen"><strong><em>request</em></strong></span> object is created by first passing a base URL to the <code>httr2::request()</code> function.</p>
<div class="fragment">
<p>Let’s circle back to the URL from the Datamart API:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy" data-id="quarto-animate-code"><code class="sourceCode r hljs"><span id="cb2-1" class="hljs-ln-code"><a></a>req <span class="ot">&lt;-</span> <span class="st">"https://mpr.datamart.ams.usda.gov/services/v1.1/reports/2993/Butter%20Prices%20and%20Sales"</span> <span class="sc">%&gt;%</span></span>
<span id="cb2-2" class="hljs-ln-code"><a></a>  httr2<span class="sc">::</span><span class="fu">request</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="fragment">
<p>This creates an object called <code>req</code> which can then be passed to the <code>httr2::req_perform()</code> function to execute the request. The <code>req</code> object includes the URL:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>&lt;httr2_request&gt;
GET https://mpr.datamart.ams.usda.gov/services/v1.1/reports/2993/Butter%20Prices%20and%20Sales
Body: empty</code></pre>
</div>
</div>
</div>
</section>
<section id="creating-a-httr2-request-1" class="slide level2" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Creating a <code>httr2</code> Request</h2>
<aside class="notes">
<p>Building the URL piece-by-piece can be helpful when it is more complex or lengthy. This can make the code more readable for the end user. It also helps when you have a situation with a lot of query parameters.</p>
<p>We start with the same idea, passing a URL to the <code>httr2::request()</code> function. However, here we use the base URL for the Datamart API.</p>
<p>The <code>req_url_path_append()</code> function lets us specify strings to add to the end of the base URL passed to <code>request()</code>. Arguments that are separated by a comma in the function will be separated by a slash in the URL. In this case, I am using the <code>URLencode()</code> function so I don’t have to type out the <code>%20</code>s to replace the spaces in the “Butter Prices and Sales” string.</p>
<p>This is also where I ran into trouble before when the <code>httr2</code> code changed in development. In an earlier version of <code>httr2</code>, the <code>req_url_path_append()</code> function would automatically encode strings before they were added to the URL. However, this apparently resulted in problems in certain cases, with characters accidentally double-encoded or incorrectly encoded. The function was changed to take the string verbatim, but it needs to be encoded properly for the request to be executed. When this changed it broke some of my code.</p>
<p>Finally, the <code>req_url_query()</code> function helps us to add query parameters at the end of the URL. In this case I am adding a parameter, <code>lastReports = 1</code> to only pull data from the most recent NDPSR report. This is mostly to simplify the results. <code>req_url_query()</code> adds a question mark automatically and separates arguments with ampersands.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<p>However, it can be helpful to build the request piece by piece (especially with a lengthy URL like this one). <code>httr2</code> also includes a suite of functions to do so:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" data-code-line-numbers="|1-2|3-6|7-9"><pre class="sourceCode numberSource r number-lines code-with-copy" data-id="quarto-animate-code"><code class="sourceCode r hljs"><span id="cb4-1" class="hljs-ln-code"><a></a>req <span class="ot">&lt;-</span> <span class="st">"https://mpr.datamart.ams.usda.gov/services/v1.1/reports"</span> <span class="sc">%&gt;%</span></span>
<span id="cb4-2" class="hljs-ln-code"><a></a>  httr2<span class="sc">::</span><span class="fu">request</span>() <span class="sc">%&gt;%</span></span>
<span id="cb4-3" class="hljs-ln-code"><a></a>  httr2<span class="sc">::</span><span class="fu">req_url_path_append</span>(</span>
<span id="cb4-4" class="hljs-ln-code"><a></a>    <span class="st">"2993"</span>,</span>
<span id="cb4-5" class="hljs-ln-code"><a></a>    <span class="fu">URLencode</span>(<span class="st">"Butter Prices and Sales"</span>)</span>
<span id="cb4-6" class="hljs-ln-code"><a></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb4-7" class="hljs-ln-code"><a></a>  httr2<span class="sc">::</span><span class="fu">req_url_query</span>(</span>
<span id="cb4-8" class="hljs-ln-code"><a></a>    <span class="at">lastReports =</span> <span class="dv">1</span></span>
<span id="cb4-9" class="hljs-ln-code"><a></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="fragment">
<p>The result is the same (or close enough; I added the <code>lastReports</code> parameter):</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>&lt;httr2_request&gt;
GET https://mpr.datamart.ams.usda.gov/services/v1.1/reports/2993/Butter%20Prices%20and%20Sales?lastReports=1
Body: empty</code></pre>
</div>
</div>
</div>
</section>
<section id="executing-a-request-and-receiving-a-response" class="slide level2">
<h2>Executing a Request and Receiving a Response</h2>
<p>A request object is passed to <code>httr2::req_perform()</code> to actually execute the request:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a></a>resp <span class="ot">&lt;-</span> req <span class="sc">%&gt;%</span></span>
<span id="cb6-2"><a></a>  httr2<span class="sc">::</span><span class="fu">req_perform</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="fragment">
<p>The response object <code>resp</code> is another list containing some pertinent information:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>&lt;httr2_response&gt;
GET https://mpr.datamart.ams.usda.gov/services/v1.1/reports/2993/Butter%20Prices%20and%20Sales?lastReports=1
Status: 200 OK
Content-Type: application/json
Body: In memory (3928 bytes)</code></pre>
</div>
</div>
</div>
<div class="fragment">
<div class="smaller-bullets" style="margin-top: 0.5em">
<ul>
<li>The HTTP verb and URL used in the request.</li>
<li><code>Status:</code> The HTTP status code. A <code>200</code> response indicates the request was successful; a code in the <code>400</code> or <code>500</code> range indicates a server error, and <code>httr2</code> will convert these to R errors automatically.</li>
<li><code>Content-Type:</code> Indicates the content returned is in JSON format.</li>
<li><code>Body:</code> Tells us there is 3.93 kB of data in memory.</li>
</ul>
</div>
<aside class="notes">
<p>As a side note, you can execute a request without creating an explicit request object or response object, i.e., without creating <code>req</code> and <code>resp</code>. I personally find it helpful, especially when learning how to use a new API.</p>
<p>If preferred, you can simply pipe a URL into <code>httr2::request()</code> and then pipe directly into <code>httr2::req_perform()</code>. It still may be helpful to save the response so you don’t have to call the API server more often than necessary.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</div>
</section>
<section id="extracting-data-from-a-response" class="slide level2" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Extracting Data from a Response</h2>
<aside class="notes">
<p>Scroll through the list output.</p>
<p>The list consists of four top-level items: <code>reportSection</code>, the name of the report section returned, <code>reportSections</code>, the names of <em>all</em> report sections for the specific slug ID, <code>stats</code>, another list containing some information on the results.</p>
<p>The <code>results</code> element is clearly what we are interested in. We can see it is itself a list with five elements, each of which is <em>another</em> list (JSON data is often a lot of nested lists) with 19 elements each. The 19 elements in the lower-level lists look like variables, including names and data types, and values. We can start to see the data structure here: a data frame with 5 rows and 19 variables.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<p>Data are saved in the <span class="hl-lightblue-lightgreen"><strong><em>body</em></strong></span> of the response object and can be extracted using a set of functions from <code>httr2</code> depending on the format of the data.</p>
<div class="fragment">
<p>Since our data are in JSON format, we can pass <code>resp</code> to <code>httr2::resp_body_json()</code>. The full JSON data prints by default, which is a lot of output. It can be helpful to use the <code>str()</code> function to look at the structure of the data first (which <em>still</em> produces a lot of output):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy" data-id="quarto-animate-code"><code class="sourceCode r hljs"><span id="cb8-1" class="hljs-ln-code"><a></a>resp <span class="sc">%&gt;%</span></span>
<span id="cb8-2" class="hljs-ln-code"><a></a>  httr2<span class="sc">::</span><span class="fu">resp_body_json</span>() <span class="sc">%&gt;%</span></span>
<span id="cb8-3" class="hljs-ln-code"><a></a>  <span class="fu">str</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 4
 $ reportSection : chr "Butter Prices and Sales"
 $ reportSections:List of 11
  ..$ : chr "Summary"
  ..$ : chr "Butter Prices and Sales"
  ..$ : chr "40 Pound Block Cheddar Cheese Prices and Sales"
  ..$ : chr "500 Pound Barrel Cheddar Cheese Prices, Sales, and Moisture Content"
  ..$ : chr "Dry Whey Prices and Sales"
  ..$ : chr "Nonfat Dry Milk Prices and Sales"
  ..$ : chr "Final Butter Prices and Sales"
  ..$ : chr "Final 40 Pound Block Cheddar Cheese Prices and Sales"
  ..$ : chr "Final 500 Pound Barrel Cheddar Cheese Prices, Sales, and Moisture Content"
  ..$ : chr "Final Dry Whey Prices and Sales"
  ..$ : chr "Final Nonfat Dry Milk Prices and Sales"
 $ stats         :List of 3
  ..$ totalRows:      : int 5
  ..$ returnedRows:   : int 5
  ..$ userAllowedRows:: int 99999
 $ results       :List of 5
  ..$ :List of 19
  .. ..$ week_ending_date     : chr "01/31/2026"
  .. ..$ created_date         : chr "02/04/2026"
  .. ..$ narrative            : NULL
  .. ..$ Week Ending Date     : chr "01/03/2026"
  .. ..$ Butter_Price         : chr "1.4318"
  .. ..$ Butter_Sales         : chr "8,382,733"
  .. ..$ report_title         : chr "National Dairy Products Sales Report (PDF)"
  .. ..$ slug_name            : chr "DYWDAIRYPRODUCTSSALES"
  .. ..$ slug_id              : chr "2993"
  .. ..$ office_name          : chr "Dairy MMR"
  .. ..$ office_code          : chr "DY-WA"
  .. ..$ office_city          : chr "Washington"
  .. ..$ office_state         : chr "DC"
  .. ..$ market_location_name : chr "Washington, DC"
  .. ..$ market_location_city : chr "Washington"
  .. ..$ market_location_state: chr "DC"
  .. ..$ market_type          : chr "FMMOS"
  .. ..$ market_type_category : chr "FMMOS - non-mars"
  .. ..$ published_date       : chr "02/04/2026 13:00:47"
  ..$ :List of 19
  .. ..$ week_ending_date     : chr "01/31/2026"
  .. ..$ created_date         : chr "02/04/2026"
  .. ..$ narrative            : NULL
  .. ..$ Week Ending Date     : chr "01/10/2026"
  .. ..$ Butter_Price         : chr "1.4241"
  .. ..$ Butter_Sales         : chr "3,028,640"
  .. ..$ report_title         : chr "National Dairy Products Sales Report (PDF)"
  .. ..$ slug_name            : chr "DYWDAIRYPRODUCTSSALES"
  .. ..$ slug_id              : chr "2993"
  .. ..$ office_name          : chr "Dairy MMR"
  .. ..$ office_code          : chr "DY-WA"
  .. ..$ office_city          : chr "Washington"
  .. ..$ office_state         : chr "DC"
  .. ..$ market_location_name : chr "Washington, DC"
  .. ..$ market_location_city : chr "Washington"
  .. ..$ market_location_state: chr "DC"
  .. ..$ market_type          : chr "FMMOS"
  .. ..$ market_type_category : chr "FMMOS - non-mars"
  .. ..$ published_date       : chr "02/04/2026 13:00:47"
  ..$ :List of 19
  .. ..$ week_ending_date     : chr "01/31/2026"
  .. ..$ created_date         : chr "02/04/2026"
  .. ..$ narrative            : NULL
  .. ..$ Week Ending Date     : chr "01/17/2026"
  .. ..$ Butter_Price         : chr "1.4130"
  .. ..$ Butter_Sales         : chr "3,890,546"
  .. ..$ report_title         : chr "National Dairy Products Sales Report (PDF)"
  .. ..$ slug_name            : chr "DYWDAIRYPRODUCTSSALES"
  .. ..$ slug_id              : chr "2993"
  .. ..$ office_name          : chr "Dairy MMR"
  .. ..$ office_code          : chr "DY-WA"
  .. ..$ office_city          : chr "Washington"
  .. ..$ office_state         : chr "DC"
  .. ..$ market_location_name : chr "Washington, DC"
  .. ..$ market_location_city : chr "Washington"
  .. ..$ market_location_state: chr "DC"
  .. ..$ market_type          : chr "FMMOS"
  .. ..$ market_type_category : chr "FMMOS - non-mars"
  .. ..$ published_date       : chr "02/04/2026 13:00:47"
  ..$ :List of 19
  .. ..$ week_ending_date     : chr "01/31/2026"
  .. ..$ created_date         : chr "02/04/2026"
  .. ..$ narrative            : NULL
  .. ..$ Week Ending Date     : chr "01/24/2026"
  .. ..$ Butter_Price         : chr "1.3655"
  .. ..$ Butter_Sales         : chr "3,605,670"
  .. ..$ report_title         : chr "National Dairy Products Sales Report (PDF)"
  .. ..$ slug_name            : chr "DYWDAIRYPRODUCTSSALES"
  .. ..$ slug_id              : chr "2993"
  .. ..$ office_name          : chr "Dairy MMR"
  .. ..$ office_code          : chr "DY-WA"
  .. ..$ office_city          : chr "Washington"
  .. ..$ office_state         : chr "DC"
  .. ..$ market_location_name : chr "Washington, DC"
  .. ..$ market_location_city : chr "Washington"
  .. ..$ market_location_state: chr "DC"
  .. ..$ market_type          : chr "FMMOS"
  .. ..$ market_type_category : chr "FMMOS - non-mars"
  .. ..$ published_date       : chr "02/04/2026 13:00:47"
  ..$ :List of 19
  .. ..$ week_ending_date     : chr "01/31/2026"
  .. ..$ created_date         : chr "02/04/2026"
  .. ..$ narrative            : NULL
  .. ..$ Week Ending Date     : chr "01/31/2026"
  .. ..$ Butter_Price         : chr "1.4962"
  .. ..$ Butter_Sales         : chr "3,415,627"
  .. ..$ report_title         : chr "National Dairy Products Sales Report (PDF)"
  .. ..$ slug_name            : chr "DYWDAIRYPRODUCTSSALES"
  .. ..$ slug_id              : chr "2993"
  .. ..$ office_name          : chr "Dairy MMR"
  .. ..$ office_code          : chr "DY-WA"
  .. ..$ office_city          : chr "Washington"
  .. ..$ office_state         : chr "DC"
  .. ..$ market_location_name : chr "Washington, DC"
  .. ..$ market_location_city : chr "Washington"
  .. ..$ market_location_state: chr "DC"
  .. ..$ market_type          : chr "FMMOS"
  .. ..$ market_type_category : chr "FMMOS - non-mars"
  .. ..$ published_date       : chr "02/04/2026 13:00:47"</code></pre>
</div>
</div>
</div>
</section>
<section id="extracting-data-purrrpluck" class="slide level2" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Extracting Data: <code>purrr::pluck()</code></h2>
<p>We can use the <a href="https://purrr.tidyverse.org/reference/pluck.html"><code>pluck()</code></a> function from the <code>purrr</code> package (part of the <code>tidyverse</code>) to extract just the <code>results</code> object from the larger list.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy" data-id="quarto-animate-code"><code class="sourceCode r hljs"><span id="cb10-1" class="hljs-ln-code"><a></a>resp <span class="sc">%&gt;%</span></span>
<span id="cb10-2" class="hljs-ln-code"><a></a>  httr2<span class="sc">::</span><span class="fu">resp_body_json</span>() <span class="sc">%&gt;%</span></span>
<span id="cb10-3" class="hljs-ln-code"><a></a>  <span class="fu">pluck</span>(<span class="st">"results"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-4" class="hljs-ln-code"><a></a>  <span class="fu">str</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 5
 $ :List of 19
  ..$ week_ending_date     : chr "01/31/2026"
  ..$ created_date         : chr "02/04/2026"
  ..$ narrative            : NULL
  ..$ Week Ending Date     : chr "01/03/2026"
  ..$ Butter_Price         : chr "1.4318"
  ..$ Butter_Sales         : chr "8,382,733"
  ..$ report_title         : chr "National Dairy Products Sales Report (PDF)"
  ..$ slug_name            : chr "DYWDAIRYPRODUCTSSALES"
  ..$ slug_id              : chr "2993"
  ..$ office_name          : chr "Dairy MMR"
  ..$ office_code          : chr "DY-WA"
  ..$ office_city          : chr "Washington"
  ..$ office_state         : chr "DC"
  ..$ market_location_name : chr "Washington, DC"
  ..$ market_location_city : chr "Washington"
  ..$ market_location_state: chr "DC"
  ..$ market_type          : chr "FMMOS"
  ..$ market_type_category : chr "FMMOS - non-mars"
  ..$ published_date       : chr "02/04/2026 13:00:47"
 $ :List of 19
  ..$ week_ending_date     : chr "01/31/2026"
  ..$ created_date         : chr "02/04/2026"
  ..$ narrative            : NULL
  ..$ Week Ending Date     : chr "01/10/2026"
  ..$ Butter_Price         : chr "1.4241"
  ..$ Butter_Sales         : chr "3,028,640"
  ..$ report_title         : chr "National Dairy Products Sales Report (PDF)"
  ..$ slug_name            : chr "DYWDAIRYPRODUCTSSALES"
  ..$ slug_id              : chr "2993"
  ..$ office_name          : chr "Dairy MMR"
  ..$ office_code          : chr "DY-WA"
  ..$ office_city          : chr "Washington"
  ..$ office_state         : chr "DC"
  ..$ market_location_name : chr "Washington, DC"
  ..$ market_location_city : chr "Washington"
  ..$ market_location_state: chr "DC"
  ..$ market_type          : chr "FMMOS"
  ..$ market_type_category : chr "FMMOS - non-mars"
  ..$ published_date       : chr "02/04/2026 13:00:47"
 $ :List of 19
  ..$ week_ending_date     : chr "01/31/2026"
  ..$ created_date         : chr "02/04/2026"
  ..$ narrative            : NULL
  ..$ Week Ending Date     : chr "01/17/2026"
  ..$ Butter_Price         : chr "1.4130"
  ..$ Butter_Sales         : chr "3,890,546"
  ..$ report_title         : chr "National Dairy Products Sales Report (PDF)"
  ..$ slug_name            : chr "DYWDAIRYPRODUCTSSALES"
  ..$ slug_id              : chr "2993"
  ..$ office_name          : chr "Dairy MMR"
  ..$ office_code          : chr "DY-WA"
  ..$ office_city          : chr "Washington"
  ..$ office_state         : chr "DC"
  ..$ market_location_name : chr "Washington, DC"
  ..$ market_location_city : chr "Washington"
  ..$ market_location_state: chr "DC"
  ..$ market_type          : chr "FMMOS"
  ..$ market_type_category : chr "FMMOS - non-mars"
  ..$ published_date       : chr "02/04/2026 13:00:47"
 $ :List of 19
  ..$ week_ending_date     : chr "01/31/2026"
  ..$ created_date         : chr "02/04/2026"
  ..$ narrative            : NULL
  ..$ Week Ending Date     : chr "01/24/2026"
  ..$ Butter_Price         : chr "1.3655"
  ..$ Butter_Sales         : chr "3,605,670"
  ..$ report_title         : chr "National Dairy Products Sales Report (PDF)"
  ..$ slug_name            : chr "DYWDAIRYPRODUCTSSALES"
  ..$ slug_id              : chr "2993"
  ..$ office_name          : chr "Dairy MMR"
  ..$ office_code          : chr "DY-WA"
  ..$ office_city          : chr "Washington"
  ..$ office_state         : chr "DC"
  ..$ market_location_name : chr "Washington, DC"
  ..$ market_location_city : chr "Washington"
  ..$ market_location_state: chr "DC"
  ..$ market_type          : chr "FMMOS"
  ..$ market_type_category : chr "FMMOS - non-mars"
  ..$ published_date       : chr "02/04/2026 13:00:47"
 $ :List of 19
  ..$ week_ending_date     : chr "01/31/2026"
  ..$ created_date         : chr "02/04/2026"
  ..$ narrative            : NULL
  ..$ Week Ending Date     : chr "01/31/2026"
  ..$ Butter_Price         : chr "1.4962"
  ..$ Butter_Sales         : chr "3,415,627"
  ..$ report_title         : chr "National Dairy Products Sales Report (PDF)"
  ..$ slug_name            : chr "DYWDAIRYPRODUCTSSALES"
  ..$ slug_id              : chr "2993"
  ..$ office_name          : chr "Dairy MMR"
  ..$ office_code          : chr "DY-WA"
  ..$ office_city          : chr "Washington"
  ..$ office_state         : chr "DC"
  ..$ market_location_name : chr "Washington, DC"
  ..$ market_location_city : chr "Washington"
  ..$ market_location_state: chr "DC"
  ..$ market_type          : chr "FMMOS"
  ..$ market_type_category : chr "FMMOS - non-mars"
  ..$ published_date       : chr "02/04/2026 13:00:47"</code></pre>
</div>
</div>
<p>But this <em>still</em> results in a list, which we have to work to convert to a data frame. What gives?</p>
<aside class="notes">
<p>Extracting just the <code>results</code> list from the JSON data is better, but still results in a list. There are ways to work this into a data frame, but the <code>narrative</code> variable being <code>NULL</code> causes some issues for us. Fortunately, there is a simpler approach.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="an-alternative-approach" class="slide level2" data-auto-animate="true">
<h2 data-id="quarto-animate-title">An Alternative Approach</h2>
<p>Setting the <code>simplifyVector</code> argument in <code>httr2::resp_body_json()</code> to <code>TRUE</code> causes it to behave exactly like <code>jsonlite::fromJSON()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12" data-code-line-numbers="|2|3"><pre class="sourceCode numberSource r number-lines code-with-copy" data-id="quarto-animate-code"><code class="sourceCode r hljs"><span id="cb12-1" class="hljs-ln-code"><a></a>resp <span class="sc">%&gt;%</span></span>
<span id="cb12-2" class="hljs-ln-code"><a></a>  httr2<span class="sc">::</span><span class="fu">resp_body_json</span>(<span class="at">simplifyVector =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-3" class="hljs-ln-code"><a></a>  <span class="fu">pluck</span>(<span class="st">"results"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["week_ending_date"],"name":[1],"type":["chr"],"align":["left"]},{"label":["created_date"],"name":[2],"type":["chr"],"align":["left"]},{"label":["narrative"],"name":[3],"type":["lgl"],"align":["right"]},{"label":["Week Ending Date"],"name":[4],"type":["chr"],"align":["left"]},{"label":["Butter_Price"],"name":[5],"type":["chr"],"align":["left"]},{"label":["Butter_Sales"],"name":[6],"type":["chr"],"align":["left"]},{"label":["report_title"],"name":[7],"type":["chr"],"align":["left"]},{"label":["slug_name"],"name":[8],"type":["chr"],"align":["left"]},{"label":["slug_id"],"name":[9],"type":["chr"],"align":["left"]},{"label":["office_name"],"name":[10],"type":["chr"],"align":["left"]},{"label":["office_code"],"name":[11],"type":["chr"],"align":["left"]},{"label":["office_city"],"name":[12],"type":["chr"],"align":["left"]},{"label":["office_state"],"name":[13],"type":["chr"],"align":["left"]},{"label":["market_location_name"],"name":[14],"type":["chr"],"align":["left"]},{"label":["market_location_city"],"name":[15],"type":["chr"],"align":["left"]},{"label":["market_location_state"],"name":[16],"type":["chr"],"align":["left"]},{"label":["market_type"],"name":[17],"type":["chr"],"align":["left"]},{"label":["market_type_category"],"name":[18],"type":["chr"],"align":["left"]},{"label":["published_date"],"name":[19],"type":["chr"],"align":["left"]}],"data":[{"1":"01/31/2026","2":"02/04/2026","3":"NA","4":"01/03/2026","5":"1.4318","6":"8,382,733","7":"National Dairy Products Sales Report (PDF)","8":"DYWDAIRYPRODUCTSSALES","9":"2993","10":"Dairy MMR","11":"DY-WA","12":"Washington","13":"DC","14":"Washington, DC","15":"Washington","16":"DC","17":"FMMOS","18":"FMMOS - non-mars","19":"02/04/2026 13:00:47","_rn_":"1"},{"1":"01/31/2026","2":"02/04/2026","3":"NA","4":"01/10/2026","5":"1.4241","6":"3,028,640","7":"National Dairy Products Sales Report (PDF)","8":"DYWDAIRYPRODUCTSSALES","9":"2993","10":"Dairy MMR","11":"DY-WA","12":"Washington","13":"DC","14":"Washington, DC","15":"Washington","16":"DC","17":"FMMOS","18":"FMMOS - non-mars","19":"02/04/2026 13:00:47","_rn_":"2"},{"1":"01/31/2026","2":"02/04/2026","3":"NA","4":"01/17/2026","5":"1.4130","6":"3,890,546","7":"National Dairy Products Sales Report (PDF)","8":"DYWDAIRYPRODUCTSSALES","9":"2993","10":"Dairy MMR","11":"DY-WA","12":"Washington","13":"DC","14":"Washington, DC","15":"Washington","16":"DC","17":"FMMOS","18":"FMMOS - non-mars","19":"02/04/2026 13:00:47","_rn_":"3"},{"1":"01/31/2026","2":"02/04/2026","3":"NA","4":"01/24/2026","5":"1.3655","6":"3,605,670","7":"National Dairy Products Sales Report (PDF)","8":"DYWDAIRYPRODUCTSSALES","9":"2993","10":"Dairy MMR","11":"DY-WA","12":"Washington","13":"DC","14":"Washington, DC","15":"Washington","16":"DC","17":"FMMOS","18":"FMMOS - non-mars","19":"02/04/2026 13:00:47","_rn_":"4"},{"1":"01/31/2026","2":"02/04/2026","3":"NA","4":"01/31/2026","5":"1.4962","6":"3,415,627","7":"National Dairy Products Sales Report (PDF)","8":"DYWDAIRYPRODUCTSSALES","9":"2993","10":"Dairy MMR","11":"DY-WA","12":"Washington","13":"DC","14":"Washington, DC","15":"Washington","16":"DC","17":"FMMOS","18":"FMMOS - non-mars","19":"02/04/2026 13:00:47","_rn_":"5"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>And returns a nicely formatted data frame when we use <code>purrr::pluck()</code> to isolate the results.</p>
<aside class="notes">
<p>The <code>httr2::resp_body_json()</code> function uses <code>jsonlite::fromJSON()</code> under the hood, but it changes the default value of <code>simplifyVector</code> from <code>TRUE</code> in <code>jsonlite::fromJSON()</code> to <code>FALSE</code>. This changes the behavior somewhat.</p>
<p>I <em>assume</em> the <code>httr2</code> developers have a good reason for doing this, but I find just setting <code>simplifyVector = TRUE</code> to often be an easier approach.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="putting-it-all-together" class="slide level2">
<h2>Putting It All Together</h2>
<aside class="notes">
<p>First we pass the base URL for the API service to the <code>httr2::request()</code> function.</p>
<p>Next, we use <code>httr2::req_url_path_append()</code> and <code>httr2::req_url_query()</code> to define the API endpoint (the specific report and section we want) and any query parameters.</p>
<p>Then the request object is passed to <code>httr2::req_perform()</code> to execute, creating the <code>resp</code> object.</p>
<p>Finally, the data are extracted from the <code>response</code> object using <code>httr2::resp_body_json()</code> and <code>purrr::pluck()</code>.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<p>We just covered a lot of different functions and syntax. Let’s see the full API call together.</p>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="cb13" data-code-line-numbers="|1-2|3-9|11-12|14-16|"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a></a>req <span class="ot">&lt;-</span> <span class="st">"https://mpr.datamart.ams.usda.gov/services/v1.1/reports"</span> <span class="sc">%&gt;%</span></span>
<span id="cb13-2"><a></a>  httr2<span class="sc">::</span><span class="fu">request</span>() <span class="sc">%&gt;%</span></span>
<span id="cb13-3"><a></a>  httr2<span class="sc">::</span><span class="fu">req_url_path_append</span>(</span>
<span id="cb13-4"><a></a>    <span class="st">"2993"</span>,</span>
<span id="cb13-5"><a></a>    <span class="fu">URLencode</span>(<span class="st">"Butter Prices and Sales"</span>)</span>
<span id="cb13-6"><a></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb13-7"><a></a>  httr2<span class="sc">::</span><span class="fu">req_url_query</span>(</span>
<span id="cb13-8"><a></a>    <span class="at">lastReports =</span> <span class="dv">1</span></span>
<span id="cb13-9"><a></a>  )</span>
<span id="cb13-10"><a></a></span>
<span id="cb13-11"><a></a>resp <span class="ot">&lt;-</span> req <span class="sc">%&gt;%</span></span>
<span id="cb13-12"><a></a>  httr2<span class="sc">::</span><span class="fu">req_perform</span>()</span>
<span id="cb13-13"><a></a></span>
<span id="cb13-14"><a></a>data <span class="ot">&lt;-</span> resp <span class="sc">%&gt;%</span></span>
<span id="cb13-15"><a></a>  httr2<span class="sc">::</span><span class="fu">resp_body_json</span>(<span class="at">simplifyVector =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb13-16"><a></a>  <span class="fu">pluck</span>(<span class="st">"results"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="fragment">
<p>Great, we have butter prices and sales data! But what about the other products? Do we have to do all of that <em>again</em>?</p>
</div>
</section></section>
<section>
<section id="creating-an-api-function" class="title-slide slide level1 inverse">
<h1>Creating an API Function</h1>

</section>
<section id="functions-allow-greater-flexibility" class="slide level2">
<h2>Functions Allow Greater Flexibility</h2>
<p>If you suspect you’ll be using a specific API regularly, especially if you’ll being varying the parameters, build a function.</p>
</section>
<section id="identify-function-arguments" class="slide level2">
<h2>Identify Function Arguments</h2>
<p>The first step is to look at the API call and identify which parts the user may want to change. Those elements will become our function arguments.</p>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a></a>req <span class="ot">&lt;-</span> <span class="st">"https://mpr.datamart.ams.usda.gov/services/v1.1/reports"</span> <span class="sc">%&gt;%</span></span>
<span id="cb14-2"><a></a>  httr2<span class="sc">::</span><span class="fu">request</span>() <span class="sc">%&gt;%</span></span>
<span id="cb14-3"><a></a>  httr2<span class="sc">::</span><span class="fu">req_url_path_append</span>(</span>
<span id="cb14-4"><a></a>    <span class="st">"2993"</span>,</span>
<span id="cb14-5"><a></a>    <span class="fu">URLencode</span>(<span class="st">"Butter Prices and Sales"</span>)</span>
<span id="cb14-6"><a></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb14-7"><a></a>  httr2<span class="sc">::</span><span class="fu">req_url_query</span>(</span>
<span id="cb14-8"><a></a>    <span class="at">lastReports =</span> <span class="dv">1</span></span>
<span id="cb14-9"><a></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li class="fragment">Slug ID: “2993” is the slug ID for the NDPSR, but a user may want to pull a different report.</li>
<li class="fragment">Section Name: A section name argument allows the user to pull different sections from a given report.</li>
<li class="fragment"><code>lastReports</code> Parameter: Allows the user to select how many recent reports to return.</li>
</ul>
</div>
</section>
<section id="datamart-api-function" class="slide level2" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Datamart API Function</h2>
<aside class="notes">
<p><code>slugid</code> is set as the first argument and is not given a default. We want the user to specify this one.</p>
<p><code>section</code> is the second argument, and is given a default value of <code>NULL</code>. Not all reports in Datamart have different sections, and a user may want to pull the full metadata for a report. This also leverages how <code>httr2</code> treats <code>NULL</code> values in the <code>httr2::req_url_path_append()</code> and <code>httr2::req_url_query()</code> functions. If a <code>NULL</code> value is provided it is simply ignored (or removed if already present).</p>
<p><code>lastReports</code> is the last argument, and is given a default value of 1. This means only the most recent report will be pulled by default. This protects the user (and the server) from being overwhelmed by large requests.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<p>With those arguments in mind, we can start building a function:</p>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="cb15" data-code-line-numbers="|2|3|4"><pre class="sourceCode numberSource r number-lines code-with-copy" data-id="quarto-animate-code"><code class="sourceCode r hljs"><span id="cb15-1" class="hljs-ln-code"><a></a>Datamart_Pull <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb15-2" class="hljs-ln-code"><a></a>    slugid,</span>
<span id="cb15-3" class="hljs-ln-code"><a></a>    <span class="at">section =</span> <span class="cn">NULL</span>,</span>
<span id="cb15-4" class="hljs-ln-code"><a></a>    <span class="at">lastReports =</span> <span class="dv">1</span></span>
<span id="cb15-5" class="hljs-ln-code"><a></a>) {</span>
<span id="cb15-6" class="hljs-ln-code"><a></a>  </span>
<span id="cb15-7" class="hljs-ln-code"><a></a>  <span class="co"># Code goes here...</span></span>
<span id="cb15-8" class="hljs-ln-code"><a></a>  </span>
<span id="cb15-9" class="hljs-ln-code"><a></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section id="datamart-api-function-1" class="slide level2" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Datamart API Function</h2>
<p>Next we add our code to generate the request and extract the results:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16" data-code-line-numbers="|7-8|10-13|15-19|21-28"><pre class="sourceCode numberSource r number-lines code-with-copy" data-id="quarto-animate-code"><code class="sourceCode r hljs"><span id="cb16-1" class="hljs-ln-code"><a></a>Datamart_Pull <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb16-2" class="hljs-ln-code"><a></a>    slugid,</span>
<span id="cb16-3" class="hljs-ln-code"><a></a>    <span class="at">section =</span> <span class="cn">NULL</span>,</span>
<span id="cb16-4" class="hljs-ln-code"><a></a>    <span class="at">lastReports =</span> <span class="dv">1</span></span>
<span id="cb16-5" class="hljs-ln-code"><a></a>) {</span>
<span id="cb16-6" class="hljs-ln-code"><a></a>  </span>
<span id="cb16-7" class="hljs-ln-code"><a></a>  <span class="co"># First set the base URL for the Datamart/LMPR API</span></span>
<span id="cb16-8" class="hljs-ln-code"><a></a>  base_url <span class="ot">&lt;-</span> <span class="st">"https://mpr.datamart.ams.usda.gov/services/v1.1/reports"</span></span>
<span id="cb16-9" class="hljs-ln-code"><a></a>  </span>
<span id="cb16-10" class="hljs-ln-code"><a></a>  <span class="co"># URL Encode Section Name</span></span>
<span id="cb16-11" class="hljs-ln-code"><a></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(section)) {</span>
<span id="cb16-12" class="hljs-ln-code"><a></a>    section <span class="ot">&lt;-</span> <span class="fu">URLencode</span>(section)</span>
<span id="cb16-13" class="hljs-ln-code"><a></a>  }</span>
<span id="cb16-14" class="hljs-ln-code"><a></a>  </span>
<span id="cb16-15" class="hljs-ln-code"><a></a>  <span class="co"># Next, define the API request (whether or not section is specified)</span></span>
<span id="cb16-16" class="hljs-ln-code"><a></a>  req <span class="ot">&lt;-</span> base_url <span class="sc">|&gt;</span></span>
<span id="cb16-17" class="hljs-ln-code"><a></a>    httr2<span class="sc">::</span><span class="fu">request</span>() <span class="sc">|&gt;</span></span>
<span id="cb16-18" class="hljs-ln-code"><a></a>    httr2<span class="sc">::</span><span class="fu">req_url_path_append</span>(slugid, section) <span class="sc">|&gt;</span></span>
<span id="cb16-19" class="hljs-ln-code"><a></a>    httr2<span class="sc">::</span><span class="fu">req_url_query</span>(<span class="at">lastReports =</span> lastReports)</span>
<span id="cb16-20" class="hljs-ln-code"><a></a>  </span>
<span id="cb16-21" class="hljs-ln-code"><a></a>  <span class="co"># Perform the API call and convert the response to JSON format</span></span>
<span id="cb16-22" class="hljs-ln-code"><a></a>  resp <span class="ot">&lt;-</span> req <span class="sc">|&gt;</span></span>
<span id="cb16-23" class="hljs-ln-code"><a></a>    httr2<span class="sc">::</span><span class="fu">req_perform</span>()</span>
<span id="cb16-24" class="hljs-ln-code"><a></a>  </span>
<span id="cb16-25" class="hljs-ln-code"><a></a>  data <span class="ot">&lt;-</span> resp <span class="sc">|&gt;</span></span>
<span id="cb16-26" class="hljs-ln-code"><a></a>    httr2<span class="sc">::</span><span class="fu">resp_body_json</span>(<span class="at">simplifyVector =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb16-27" class="hljs-ln-code"><a></a>    purrr<span class="sc">::</span><span class="fu">pluck</span>(<span class="st">"results"</span>) <span class="sc">|&gt;</span></span>
<span id="cb16-28" class="hljs-ln-code"><a></a>    <span class="fu">as_tibble</span>()</span>
<span id="cb16-29" class="hljs-ln-code"><a></a>  </span>
<span id="cb16-30" class="hljs-ln-code"><a></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<aside class="notes">
<p>We set the <code>base_url</code> to the common URL used for all Datamart API calls. This can be hardcoded since it is not going to change.</p>
<p>Next, we use <code>URLencode()</code> to make sure the section name is properly formatted, given that we know the Datamart report section names often include spaces.</p>
<p>Then we define the <code>httr2</code> <code>request</code> object. We use <code>httr2::req_url_path_append</code> to append the <code>slugid</code> argument and <code>section</code> argument to the end of the URL, then use <code>httr2::req_url_query</code> to set the lastReports query parameter.</p>
<p>Finally, the request is executed and the results are extracted and saved as a tibble.</p>
<p>By assigning the results to the <code>data</code> object, the <code>Datamart_Pull()</code> function will not print the results when run. It will assign the results to a new object though. This is to save the user from accidentally printing a ton of output to the console.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="datamart_pull-in-action" class="slide level2">
<h2><code>Datamart_Pull()</code> in Action</h2>
<p>Let’s use the new <code>Datamart_Pull()</code> function to pull cheese prices from the last four reports:</p>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a></a><span class="fu">Datamart_Pull</span>(<span class="at">slugid =</span> <span class="st">"2993"</span>,</span>
<span id="cb17-2"><a></a>              <span class="at">section =</span> <span class="st">"40 Pound Block Cheddar Cheese Prices and Sales"</span>,</span>
<span id="cb17-3"><a></a>              <span class="at">lastReports =</span> <span class="dv">4</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-4"><a></a>  <span class="fu">select</span>(<span class="at">Report_Week =</span> week_ending_date, <span class="at">Week_Ending =</span> <span class="st">`</span><span class="at">Week Ending Date</span><span class="st">`</span>, cheese_40_Price, cheese_40_Sales)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["Report_Week"],"name":[1],"type":["chr"],"align":["left"]},{"label":["Week_Ending"],"name":[2],"type":["chr"],"align":["left"]},{"label":["cheese_40_Price"],"name":[3],"type":["chr"],"align":["left"]},{"label":["cheese_40_Sales"],"name":[4],"type":["chr"],"align":["left"]}],"data":[{"1":"01/31/2026","2":"01/03/2026","3":"1.4174","4":"8,360,834"},{"1":"01/31/2026","2":"01/10/2026","3":"1.4126","4":"12,658,208"},{"1":"01/31/2026","2":"01/17/2026","3":"1.4015","4":"10,625,004"},{"1":"01/31/2026","2":"01/24/2026","3":"1.3873","4":"9,708,878"},{"1":"01/31/2026","2":"01/31/2026","3":"1.3805","4":"9,355,932"},{"1":"01/24/2026","2":"12/27/2025","3":"1.4350","4":"10,400,019"},{"1":"01/24/2026","2":"01/03/2026","3":"1.4174","4":"8,360,834"},{"1":"01/24/2026","2":"01/10/2026","3":"1.4126","4":"12,658,208"},{"1":"01/24/2026","2":"01/17/2026","3":"1.4015","4":"10,625,004"},{"1":"01/24/2026","2":"01/24/2026","3":"1.3873","4":"9,708,878"},{"1":"01/17/2026","2":"12/20/2025","3":"1.5043","4":"11,509,241"},{"1":"01/17/2026","2":"12/27/2025","3":"1.4350","4":"10,400,019"},{"1":"01/17/2026","2":"01/03/2026","3":"1.4174","4":"8,360,834"},{"1":"01/17/2026","2":"01/10/2026","3":"1.4126","4":"12,658,208"},{"1":"01/17/2026","2":"01/17/2026","3":"1.4021","4":"10,505,691"},{"1":"01/10/2026","2":"12/13/2025","3":"1.5451","4":"10,880,650"},{"1":"01/10/2026","2":"12/20/2025","3":"1.5043","4":"11,509,241"},{"1":"01/10/2026","2":"12/27/2025","3":"1.4350","4":"10,400,019"},{"1":"01/10/2026","2":"01/03/2026","3":"1.4174","4":"8,360,834"},{"1":"01/10/2026","2":"01/10/2026","3":"1.4131","4":"12,479,491"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<aside class="notes">
<p>Now that we have this code wrapped up in a function, it is a lot easier to use for different purposes. We easily swapped out the section name to get a different set of prices and changed the <code>lastReports</code> parameter to pull more data.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</div>
</section>
<section id="utilizing-purrrmap" class="slide level2" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Utilizing <code>purrr::map()</code></h2>
<p>Since we might want to pull all the product prices at the same time, we can utilize the <a href="https://purrr.tidyverse.org/reference/map.html"><code>map()</code></a> function from the <code>purrr</code> package to iterate over a list:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy" data-id="quarto-animate-code"><code class="sourceCode r hljs"><span id="cb18-1" class="hljs-ln-code"><a></a><span class="fu">list</span>(</span>
<span id="cb18-2" class="hljs-ln-code"><a></a>  <span class="st">"Butter Prices and Sales"</span>,</span>
<span id="cb18-3" class="hljs-ln-code"><a></a>  <span class="st">"40 Pound Block Cheddar Cheese Prices and Sales"</span>,</span>
<span id="cb18-4" class="hljs-ln-code"><a></a>  <span class="st">"Dry Whey Prices and Sales"</span>,</span>
<span id="cb18-5" class="hljs-ln-code"><a></a>  <span class="st">"Nonfat Dry Milk Prices and Sales"</span></span>
<span id="cb18-6" class="hljs-ln-code"><a></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<aside class="notes">
<p>I admit this next bit might be getting a bit advanced, but I think it is a really important concept to discuss briefly.</p>
<p>A huge benefit of writing your own functions is using those functions to iterate over lists. If we wanted to pull all of the product price data at once, we can pass a list of the four different section names to the <code>map()</code> function and apply <code>Datamart_Pull()</code> to each element of the list.</p>
<p>We start by defining a list with all of the section names.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="utilizing-purrrmap-1" class="slide level2" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Utilizing <code>purrr::map()</code></h2>
<p>Since we might want to pull all the product prices at the same time, we can utilize the <a href="https://purrr.tidyverse.org/reference/map.html"><code>map()</code></a> function from the <code>purrr</code> package to iterate over a list:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy" data-id="quarto-animate-code"><code class="sourceCode r hljs"><span id="cb19-1" class="hljs-ln-code"><a></a><span class="fu">list</span>(</span>
<span id="cb19-2" class="hljs-ln-code"><a></a>  <span class="st">"Butter Prices and Sales"</span>,</span>
<span id="cb19-3" class="hljs-ln-code"><a></a>  <span class="st">"40 Pound Block Cheddar Cheese Prices and Sales"</span>,</span>
<span id="cb19-4" class="hljs-ln-code"><a></a>  <span class="st">"Dry Whey Prices and Sales"</span>,</span>
<span id="cb19-5" class="hljs-ln-code"><a></a>  <span class="st">"Nonfat Dry Milk Prices and Sales"</span></span>
<span id="cb19-6" class="hljs-ln-code"><a></a>) <span class="sc">%&gt;%</span></span>
<span id="cb19-7" class="hljs-ln-code"><a></a>  <span class="fu">map</span>(</span>
<span id="cb19-8" class="hljs-ln-code"><a></a>    \(x) <span class="fu">Datamart_Pull</span>(<span class="at">slugid =</span> <span class="st">"2993"</span>, <span class="at">section =</span> x)</span>
<span id="cb19-9" class="hljs-ln-code"><a></a>  ) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
# A tibble: 5 × 19
  week_ending_date created_date narrative `Week Ending Date` Butter_Price
  &lt;chr&gt;            &lt;chr&gt;        &lt;lgl&gt;     &lt;chr&gt;              &lt;chr&gt;       
1 01/31/2026       02/04/2026   NA        01/03/2026         1.4318      
2 01/31/2026       02/04/2026   NA        01/10/2026         1.4241      
3 01/31/2026       02/04/2026   NA        01/17/2026         1.4130      
4 01/31/2026       02/04/2026   NA        01/24/2026         1.3655      
5 01/31/2026       02/04/2026   NA        01/31/2026         1.4962      
# ℹ 14 more variables: Butter_Sales &lt;chr&gt;, report_title &lt;chr&gt;, slug_name &lt;chr&gt;,
#   slug_id &lt;chr&gt;, office_name &lt;chr&gt;, office_code &lt;chr&gt;, office_city &lt;chr&gt;,
#   office_state &lt;chr&gt;, market_location_name &lt;chr&gt;, market_location_city &lt;chr&gt;,
#   market_location_state &lt;chr&gt;, market_type &lt;chr&gt;, market_type_category &lt;chr&gt;,
#   published_date &lt;chr&gt;

[[2]]
# A tibble: 5 × 19
  week_ending_date created_date narrative `Week Ending Date` cheese_40_Price
  &lt;chr&gt;            &lt;chr&gt;        &lt;lgl&gt;     &lt;chr&gt;              &lt;chr&gt;          
1 01/31/2026       02/04/2026   NA        01/03/2026         1.4174         
2 01/31/2026       02/04/2026   NA        01/10/2026         1.4126         
3 01/31/2026       02/04/2026   NA        01/17/2026         1.4015         
4 01/31/2026       02/04/2026   NA        01/24/2026         1.3873         
5 01/31/2026       02/04/2026   NA        01/31/2026         1.3805         
# ℹ 14 more variables: cheese_40_Sales &lt;chr&gt;, report_title &lt;chr&gt;,
#   slug_name &lt;chr&gt;, slug_id &lt;chr&gt;, office_name &lt;chr&gt;, office_code &lt;chr&gt;,
#   office_city &lt;chr&gt;, office_state &lt;chr&gt;, market_location_name &lt;chr&gt;,
#   market_location_city &lt;chr&gt;, market_location_state &lt;chr&gt;, market_type &lt;chr&gt;,
#   market_type_category &lt;chr&gt;, published_date &lt;chr&gt;

[[3]]
# A tibble: 5 × 19
  week_ending_date created_date narrative `Week Ending Date` whey_Price
  &lt;chr&gt;            &lt;chr&gt;        &lt;lgl&gt;     &lt;chr&gt;              &lt;chr&gt;     
1 01/31/2026       02/04/2026   NA        01/03/2026         0.7040    
2 01/31/2026       02/04/2026   NA        01/10/2026         0.7072    
3 01/31/2026       02/04/2026   NA        01/17/2026         0.7013    
4 01/31/2026       02/04/2026   NA        01/24/2026         0.6986    
5 01/31/2026       02/04/2026   NA        01/31/2026         0.6861    
# ℹ 14 more variables: whey_Sales &lt;chr&gt;, report_title &lt;chr&gt;, slug_name &lt;chr&gt;,
#   slug_id &lt;chr&gt;, office_name &lt;chr&gt;, office_code &lt;chr&gt;, office_city &lt;chr&gt;,
#   office_state &lt;chr&gt;, market_location_name &lt;chr&gt;, market_location_city &lt;chr&gt;,
#   market_location_state &lt;chr&gt;, market_type &lt;chr&gt;, market_type_category &lt;chr&gt;,
#   published_date &lt;chr&gt;

[[4]]
# A tibble: 5 × 19
  week_ending_date created_date narrative `Week Ending Date` nonfat_milk_Price
  &lt;chr&gt;            &lt;chr&gt;        &lt;lgl&gt;     &lt;chr&gt;              &lt;chr&gt;            
1 01/31/2026       02/04/2026   NA        01/03/2026         1.1648           
2 01/31/2026       02/04/2026   NA        01/10/2026         1.1794           
3 01/31/2026       02/04/2026   NA        01/17/2026         1.1914           
4 01/31/2026       02/04/2026   NA        01/24/2026         1.2032           
5 01/31/2026       02/04/2026   NA        01/31/2026         1.2197           
# ℹ 14 more variables: nonfat_milk_Sales &lt;chr&gt;, report_title &lt;chr&gt;,
#   slug_name &lt;chr&gt;, slug_id &lt;chr&gt;, office_name &lt;chr&gt;, office_code &lt;chr&gt;,
#   office_city &lt;chr&gt;, office_state &lt;chr&gt;, market_location_name &lt;chr&gt;,
#   market_location_city &lt;chr&gt;, market_location_state &lt;chr&gt;, market_type &lt;chr&gt;,
#   market_type_category &lt;chr&gt;, published_date &lt;chr&gt;</code></pre>
</div>
</div>
<aside class="notes">
<p>Then, this list is passed into the <code>map()</code> function.</p>
<p><code>map()</code> takes a list or vector as its first argument, which is exactly what we are piping in.</p>
<p>The second argument is a function to apply to each element of the list. In this case we define the function using an <strong><em>anonymous function</em></strong>. The anonymous function allows us to plug <code>x</code> into the <code>section</code> argument in <code>Datamart_Pull()</code>. The <code>slugid</code> argument is hardcoded because we are pulling from the same report.</p>
<p>The result is a list with four elements, each of which is a tibble containing the requested data <em>(scroll through to show this)</em>.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="utilizing-purrrmap-2" class="slide level2" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Utilizing <code>purrr::map()</code></h2>
<p>Since we might want to pull all the product prices at the same time, we can utilize the <a href="https://purrr.tidyverse.org/reference/map.html"><code>map()</code></a> function from the <code>purrr</code> package to iterate over a list:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy" data-id="quarto-animate-code"><code class="sourceCode r hljs"><span id="cb21-1" class="hljs-ln-code"><a></a><span class="fu">list</span>(</span>
<span id="cb21-2" class="hljs-ln-code"><a></a>  <span class="st">"Butter Prices and Sales"</span>,</span>
<span id="cb21-3" class="hljs-ln-code"><a></a>  <span class="st">"40 Pound Block Cheddar Cheese Prices and Sales"</span>,</span>
<span id="cb21-4" class="hljs-ln-code"><a></a>  <span class="st">"Dry Whey Prices and Sales"</span>,</span>
<span id="cb21-5" class="hljs-ln-code"><a></a>  <span class="st">"Nonfat Dry Milk Prices and Sales"</span></span>
<span id="cb21-6" class="hljs-ln-code"><a></a>) <span class="sc">%&gt;%</span></span>
<span id="cb21-7" class="hljs-ln-code"><a></a>  <span class="fu">map</span>(</span>
<span id="cb21-8" class="hljs-ln-code"><a></a>    \(x) <span class="fu">Datamart_Pull</span>(<span class="at">slugid =</span> <span class="st">"2993"</span>, <span class="at">section =</span> x)</span>
<span id="cb21-9" class="hljs-ln-code"><a></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb21-10" class="hljs-ln-code"><a></a>  <span class="fu">map</span>(</span>
<span id="cb21-11" class="hljs-ln-code"><a></a>    \(x) <span class="fu">select</span>(x, <span class="sc">-</span><span class="fu">c</span>(created_date, narrative, report_title<span class="sc">:</span>published_date))</span>
<span id="cb21-12" class="hljs-ln-code"><a></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb21-13" class="hljs-ln-code"><a></a>  <span class="fu">reduce</span>(left_join, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"week_ending_date"</span>, <span class="st">"Week Ending Date"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["week_ending_date"],"name":[1],"type":["chr"],"align":["left"]},{"label":["Week Ending Date"],"name":[2],"type":["chr"],"align":["left"]},{"label":["Butter_Price"],"name":[3],"type":["chr"],"align":["left"]},{"label":["Butter_Sales"],"name":[4],"type":["chr"],"align":["left"]},{"label":["cheese_40_Price"],"name":[5],"type":["chr"],"align":["left"]},{"label":["cheese_40_Sales"],"name":[6],"type":["chr"],"align":["left"]},{"label":["whey_Price"],"name":[7],"type":["chr"],"align":["left"]},{"label":["whey_Sales"],"name":[8],"type":["chr"],"align":["left"]},{"label":["nonfat_milk_Price"],"name":[9],"type":["chr"],"align":["left"]},{"label":["nonfat_milk_Sales"],"name":[10],"type":["chr"],"align":["left"]}],"data":[{"1":"01/31/2026","2":"01/03/2026","3":"1.4318","4":"8,382,733","5":"1.4174","6":"8,360,834","7":"0.7040","8":"4,142,796","9":"1.1648","10":"13,971,985"},{"1":"01/31/2026","2":"01/10/2026","3":"1.4241","4":"3,028,640","5":"1.4126","6":"12,658,208","7":"0.7072","8":"5,660,855","9":"1.1794","10":"16,784,007"},{"1":"01/31/2026","2":"01/17/2026","3":"1.4130","4":"3,890,546","5":"1.4015","6":"10,625,004","7":"0.7013","8":"6,803,068","9":"1.1914","10":"19,675,025"},{"1":"01/31/2026","2":"01/24/2026","3":"1.3655","4":"3,605,670","5":"1.3873","6":"9,708,878","7":"0.6986","8":"7,170,586","9":"1.2032","10":"14,266,582"},{"1":"01/31/2026","2":"01/31/2026","3":"1.4962","4":"3,415,627","5":"1.3805","6":"9,355,932","7":"0.6861","8":"7,101,885","9":"1.2197","10":"16,317,463"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<aside class="notes">
<p>Since we still have a list object, we can pass it into another <code>map()</code> call. Here I am just dropping a few unneccessary variables.</p>
<p>I then combine the tibbles into a single tibble using the <code>reduce()</code> function and a <code>left_join</code> on the two date variables.</p>
<p>The result is a single tibble containing prices and sales data for all four products.</p>
<p>One thing to note is that these are <em>all</em> character type variables. So we still have some data cleaning steps before we can start working with the data.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="further-improvements" class="slide level2">
<h2>Further Improvements</h2>
<p>The <code>Datamart_Pull()</code> function we’ve built is fairly bare bones, but it gets the job done. There are several potential improvements that could make it more user friendly and foolproof:</p>
<ul>
<li class="fragment">Check the argument types and throw a helpful error if there is a type mismatch.</li>
<li class="fragment">Create specific functions for each endpoint: Define a new function for just the NDPSR (slug ID 2993) so the user does not need to know more about the details of the API.</li>
<li class="fragment">Allow more arguments: The Datamart API allows more query parameters in addition to <code>lastReports</code>, such as filtering by a date. Include more arguments for the user to set (which might be easier with specific functions for each endpoint).</li>
<li class="fragment">Build a package!</li>
</ul>
</section></section>
<section>
<section id="handling-authentication" class="title-slide slide level1 inverse">
<h1>Handling Authentication</h1>

</section>
<section id="what-is-authentication" class="slide level2">
<h2>What is Authentication?</h2>
<aside class="notes">
<p>There is technically a distinction between “authentication” and “authorization”, but it likely does not matter for most of our use cases. An example would be if an API restricts access to certain data to only senior-level members of an organization. In this case, a user may be <em>authenticated</em> properly but not <em>authorized</em> for a certain request.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<p>Datamart is a fairly simple API since it does not require authentication to use. However, many APIs require users to be authenticated and authorized before they will return data.</p>
<div class="fragment">
<p><span class="hl-lightblue-lightgreen"><strong><em>Authentication</em></strong></span> is the process by which an application confirms a user’s identity.</p>
<p><span class="hl-lightblue-lightgreen"><strong><em>Authorization</em></strong></span> is a further step which confirms whether an authenticated user is authorized to access the requested information.</p>
</div>
<div class="fragment">
<p>Authentication is often handled by assigning an <span class="hl-lightblue-lightgreen"><strong><em>API key</em></strong></span>, an alphanumeric combination unique to each user. In some cases, users may use a username and password for authentication.</p>
</div>
<div class="fragment">
<p>Requiring authentication helps APIs manage access by tracking usage and enforcing limits. Even if it is free to sign up for an API key, they ensure an extra layer of security.</p>
</div>
</section>
<section id="another-scenario-my-market-news" class="slide level2">
<h2>Another Scenario: My Market News</h2>
<aside class="notes">
<p>My Market News includes data from Cotton &amp; Tobacco Market News; Dairy Market News; Livestock, Poultry, and Grain Market News; and Specialty Crops Market News.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<div class="columns">
<div class="column" style="width:60%;">
<p><a href="https://mymarketnews.ams.usda.gov/">My Market News</a> is another AMS website hosting data from across Market News divisions.</p>
<p><span class="fragment">My Market News also has an API service, with <a href="https://mymarketnews.ams.usda.gov/mymarketnews-api">documentation</a> available. The My Market News API requires users to have an API key.</span></p>
<p><span class="fragment">Let’s use the My Market News API to pull some more dairy data.</span></p>
</div><div class="column" style="width:40%;">
<p><a href="https://mymarketnews.ams.usda.gov/"><img data-src="images/MMN-Main-Page.png" alt="Main page of My Market News website"></a></p>
</div></div>
</section>
<section id="secret-management" class="slide level2">
<h2>Secret Management</h2>
<p>API keys are considered <span class="hl-lightblue-lightgreen"><strong><em>secrets</em></strong></span> in computer science parlance.</p>
<div class="fragment">
<p><span class="hl-lightblue-lightgreen"><strong><em>Secrets</em></strong></span> are sensitive information a user wants to keep secret. When transmitting a secret over the internet (as we do when making HTTP requests), so additional care is required.</p>
</div>
<div class="fragment">
<p>The easiest way to manage API keys for use in R is to store them in an <code>.Renviron</code> file. <code>.Renviron</code> is read by R on startup, creating environmental variables that are accessible in an R session with <code>Sys.getenv()</code>.</p>
</div>
<div class="fragment">
<p>Environmental variables are saved as key-value pairs. <code>.Renviron</code> is easily accessed with the <code>usethis::edit_r_environ()</code> function.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>.Renviron</strong></pre>
</div>
<div class="sourceCode" id="cb22" data-filename=".Renviron"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb22-1"><a></a><span class="va">NASSQS_TOKEN</span><span class="op">=</span><span class="st">"abc123"</span></span>
<span id="cb22-2"><a></a><span class="va">MMN_API_KEY</span><span class="op">=</span><span class="st">"def456"</span></span>
<span id="cb22-3"><a></a><span class="va">FRED_API_KEY</span><span class="op">=</span><span class="st">"ghi789"</span></span>
<span id="cb22-4"><a></a><span class="va">CENSUS_API_KEY</span><span class="op">=</span><span class="st">"jkl101112"</span></span>
<span id="cb22-5"><a></a> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section id="using-the-my-market-news-api" class="slide level2" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Using the My Market News API</h2>
<p>Let’s try to pull prices for <a href="https://mymarketnews.ams.usda.gov/viewReport/1039">Oceania Whole Milk Powder</a>.</p>
<p>As we did with the Datamart API, we start by building a <code>httr2</code> request:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy" data-id="quarto-animate-code"><code class="sourceCode r hljs"><span id="cb23-1" class="hljs-ln-code"><a></a>req <span class="ot">&lt;-</span> <span class="st">"https://marsapi.ams.usda.gov/services/v1.2/reports"</span> <span class="sc">%&gt;%</span></span>
<span id="cb23-2" class="hljs-ln-code"><a></a>  httr2<span class="sc">::</span><span class="fu">request</span>() <span class="sc">%&gt;%</span></span>
<span id="cb23-3" class="hljs-ln-code"><a></a>  httr2<span class="sc">::</span><span class="fu">req_url_path_append</span>(<span class="st">"1039"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="using-the-my-market-news-api-1" class="slide level2" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Using the My Market News API</h2>
<p>Let’s try to pull prices for <a href="https://mymarketnews.ams.usda.gov/viewReport/1039">Oceania Whole Milk Powder</a>.</p>
<p>As we did with the Datamart API, we start by building a <code>httr2</code> request:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy" data-id="quarto-animate-code"><code class="sourceCode r hljs"><span id="cb24-1" class="hljs-ln-code"><a></a>req <span class="ot">&lt;-</span> <span class="st">"https://marsapi.ams.usda.gov/services/v1.2/reports"</span> <span class="sc">%&gt;%</span></span>
<span id="cb24-2" class="hljs-ln-code"><a></a>  httr2<span class="sc">::</span><span class="fu">request</span>() <span class="sc">%&gt;%</span></span>
<span id="cb24-3" class="hljs-ln-code"><a></a>  httr2<span class="sc">::</span><span class="fu">req_url_path_append</span>(<span class="st">"1039"</span>)</span>
<span id="cb24-4" class="hljs-ln-code"><a></a></span>
<span id="cb24-5" class="hljs-ln-code"><a></a>resp <span class="ot">&lt;-</span> req <span class="sc">%&gt;%</span></span>
<span id="cb24-6" class="hljs-ln-code"><a></a>  httr2<span class="sc">::</span><span class="fu">req_perform</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in `httr2::req_perform()`:
! HTTP 403 Forbidden.</code></pre>
</div>
</div>
<div class="fragment">
<p>Uh oh, an error!</p>
</div>
</section>
<section id="what-caused-the-error" class="slide level2">
<h2>What caused the error?</h2>
<aside class="notes">
<p>Even though the culprit behind this error is pretty obvious (we didn’t actually use our API key), this is a good opportunity to investigate how to look into an error message in further detail.</p>
<p>When we look at the <code>$message</code> and <code>$detail</code> elements of the JSON list that was returned, we can see “Access is denied” due to not being authenticated. We can remedy this easily by using our API key.</p>
<p><code>httr2</code> also has tools for building more informative error messages, which will print properly in the R console, for any functions you build.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<p>Sometimes you will need to investigate what is causing an error more closely. Luckily, <code>httr2</code> allows us to do so even if the request failed.</p>
<div class="fragment">
<p>The <code>httr2::last_response()</code> function will return the <code>response</code> object even if an error caused the code to fail. We can read the contents using <code>httr2::resp_body_json()</code>:</p>
</div>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a></a>httr2<span class="sc">::</span><span class="fu">last_response</span>() <span class="sc">%&gt;%</span></span>
<span id="cb26-2"><a></a>  httr2<span class="sc">::</span><span class="fu">resp_body_json</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$status
[1] "403 - Forbidden"

$errorCode
[1] 403

$message
[1] "Access is denied"

$detail
[1] "Attempt to access the protected resource. Please use HELP LINK for more information: https://marsapi.ams.usda.gov/services/help"

$dateTime
[1] "2026-02-05T09:44:58.7690015"</code></pre>
</div>
</div>
</div>
</section>
<section id="using-my-market-news-api-with-authentication" class="slide level2" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Using My Market News API with Authentication</h2>
<aside class="notes">
<p>The My Market News API uses basic authentication, so we can use the <code>httr2::req_auth_basic()</code> function to set our API key. I’m using <code>Sys.getenv()</code> to pull my API key from my <code>.Renviron</code> file.</p>
<p>You’ll notice I’m setting my API key as both the username and password in <code>httr2::req_auth_basic()</code>. This may seem redundant, but its due to a bit of a quirk from both the My Market News API and the way the <code>httr2</code> function works.</p>
<p>The My Market News documentation says to use the API key as the basic authentication username value, and says a password is not required. Which suggests we could just set the <code>username</code> argument in <code>httr2::req_auth_basic()</code>. However, the <code>httr2::req_auth_basic()</code> function is built with a nice user-friendly feature that causes an unfortunate issue here. If the <code>password</code> argument is left blank, it will prompt the user to enter a password through a popup window. When this happens, the password cannot be left blank. Therefore, I find it easiest to just pass the API key to both arguments. The My Market News API does not seem to care, so this works fine.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<p>Let’s try that again. <code>httr2</code> provides the <code>httr2::req_auth_basic()</code> function to facilitate basic authentication. We can supply it with our API key:</p>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="cb28" data-code-line-numbers="|4-5"><pre class="sourceCode numberSource r number-lines code-with-copy" data-id="quarto-animate-code"><code class="sourceCode r hljs"><span id="cb28-1" class="hljs-ln-code"><a></a>req <span class="ot">&lt;-</span> <span class="st">"https://marsapi.ams.usda.gov/services/v1.2/reports"</span> <span class="sc">%&gt;%</span></span>
<span id="cb28-2" class="hljs-ln-code"><a></a>  httr2<span class="sc">::</span><span class="fu">request</span>() <span class="sc">%&gt;%</span></span>
<span id="cb28-3" class="hljs-ln-code"><a></a>  httr2<span class="sc">::</span><span class="fu">req_url_path_append</span>(<span class="st">"1039"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb28-4" class="hljs-ln-code"><a></a>  httr2<span class="sc">::</span><span class="fu">req_auth_basic</span>(<span class="at">username =</span> <span class="fu">Sys.getenv</span>(<span class="st">"MMN_API_KEY"</span>),</span>
<span id="cb28-5" class="hljs-ln-code"><a></a>                        <span class="at">password =</span> <span class="fu">Sys.getenv</span>(<span class="st">"MMN_API_KEY"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section id="using-my-market-news-api-with-authentication-1" class="slide level2" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Using My Market News API with Authentication</h2>
<p>Let’s try that again. <code>httr2</code> provides the <code>httr2::req_auth_basic()</code> function to facilitate basic authentication. We can supply it with our API key:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy" data-id="quarto-animate-code"><code class="sourceCode r hljs"><span id="cb29-1" class="hljs-ln-code"><a></a>req <span class="ot">&lt;-</span> <span class="st">"https://marsapi.ams.usda.gov/services/v1.2/reports"</span> <span class="sc">%&gt;%</span></span>
<span id="cb29-2" class="hljs-ln-code"><a></a>  httr2<span class="sc">::</span><span class="fu">request</span>() <span class="sc">%&gt;%</span></span>
<span id="cb29-3" class="hljs-ln-code"><a></a>  httr2<span class="sc">::</span><span class="fu">req_url_path_append</span>(<span class="st">"1039"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb29-4" class="hljs-ln-code"><a></a>  httr2<span class="sc">::</span><span class="fu">req_auth_basic</span>(<span class="at">username =</span> <span class="fu">Sys.getenv</span>(<span class="st">"MMN_API_KEY"</span>),</span>
<span id="cb29-5" class="hljs-ln-code"><a></a>                        <span class="at">password =</span> <span class="fu">Sys.getenv</span>(<span class="st">"MMN_API_KEY"</span>))</span>
<span id="cb29-6" class="hljs-ln-code"><a></a></span>
<span id="cb29-7" class="hljs-ln-code"><a></a>req</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;httr2_request&gt;
GET https://marsapi.ams.usda.gov/services/v1.2/reports/1039
Headers:
* Authorization: &lt;REDACTED&gt;
Body: empty</code></pre>
</div>
</div>
<p>Examining the <code>request</code> object, we can see the <code>Authorization</code> header is set, but automatically redacted by <code>httr2</code> for security.</p>
</section>
<section id="using-my-market-news-api-with-authentication-2" class="slide level2" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Using My Market News API with Authentication</h2>
<aside class="notes">
<p>The <code>200 OK</code> status code tells us the request went through successfully. I won’t go through the process of extracting the data again as it is the same as with the Datamart API.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<p>Let’s try that again. <code>httr2</code> provides the <code>httr2::req_auth_basic()</code> function to facilitate basic authentication. We can supply it with our API key:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy" data-id="quarto-animate-code"><code class="sourceCode r hljs"><span id="cb31-1" class="hljs-ln-code"><a></a>req <span class="ot">&lt;-</span> <span class="st">"https://marsapi.ams.usda.gov/services/v1.2/reports"</span> <span class="sc">%&gt;%</span></span>
<span id="cb31-2" class="hljs-ln-code"><a></a>  httr2<span class="sc">::</span><span class="fu">request</span>() <span class="sc">%&gt;%</span></span>
<span id="cb31-3" class="hljs-ln-code"><a></a>  httr2<span class="sc">::</span><span class="fu">req_url_path_append</span>(<span class="st">"1039"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb31-4" class="hljs-ln-code"><a></a>  httr2<span class="sc">::</span><span class="fu">req_auth_basic</span>(<span class="at">username =</span> <span class="fu">Sys.getenv</span>(<span class="st">"MMN_API_KEY"</span>),</span>
<span id="cb31-5" class="hljs-ln-code"><a></a>                        <span class="at">password =</span> <span class="fu">Sys.getenv</span>(<span class="st">"MMN_API_KEY"</span>))</span>
<span id="cb31-6" class="hljs-ln-code"><a></a></span>
<span id="cb31-7" class="hljs-ln-code"><a></a>req <span class="sc">%&gt;%</span></span>
<span id="cb31-8" class="hljs-ln-code"><a></a>  httr2<span class="sc">::</span><span class="fu">req_perform</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;httr2_response&gt;
GET https://marsapi.ams.usda.gov/services/v1.2/reports/1039
Status: 200 OK
Content-Type: application/json
Body: In memory (1105122 bytes)</code></pre>
</div>
</div>
<p>We have a successful response!</p>
<div class="fragment">
<p>Extracting data from the response is the same as with the Datamart API.</p>
</div>
</section>
<section id="another-note-on-authentication" class="slide level2">
<h2>Another Note on Authentication</h2>
<aside class="notes">
<p>It is worth mentioning that there are several types of API authentication you may run into.</p>
<p>Admittedly, I do not know a lot of details about how these work beyond basic authentication. However, <code>httr2</code> has functionality to address these forms of authentication if you run into them.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<p>APIs can handle authentication in a number of different ways:</p>
<ul>
<li class="fragment">The simplest, but also least secure, method is to supply the API key as a query parameter. This can be done using <code>httr2::req_url_query()</code>.</li>
<li class="fragment">Basic authentication: Uses an HTTP header to provide credentials, which may include a username and/or password. This is the form we used with the My Market News API.</li>
<li class="fragment">JSON Web Token (JWT): A user is supplied with a digitally-signed token when they initially log into an application. The token is then required in each subsequent request.</li>
<li class="fragment">OAuth: A framework that uses a third party to authenticate a user. For example, when you are prompted to log into a website using a Google account.</li>
</ul>
<div class="fragment">
<p><code>httr2</code> has functions to support authentication using any of these forms.</p>
</div>
</section></section>
<section>
<section id="wrapping-up" class="title-slide slide level1 inverse">
<h1>Wrapping Up</h1>

</section>
<section id="summarizing-what-we-learned" class="slide level2">
<h2>Summarizing What We Learned</h2>
<ul>
<li class="fragment"><span class="hl-lightblue-lightgreen"><strong><em>Web APIs</em></strong></span> allow <em>authorized</em> users to access data through a structured <em>request-response</em> framework.</li>
<li class="fragment"><span style="font-weight: bold"><code>httr2</code></span> is a package that provides a framework for building and executing HTTP requests.</li>
<li class="fragment">Create a <code>httr2</code> request by passing a base URL to <code>httr2::request()</code>.
<ul>
<li class="fragment">Build on that request using <code>httr2::req_url_path_append()</code> and <code>httr2::req_url_query()</code>.</li>
<li class="fragment">Set the authorization header using <code>httr2::req_auth_basic()</code> (or similar functions).</li>
</ul></li>
<li class="fragment">Execute a <code>httr2</code> request by passing it to <code>httr2::req_perform()</code>.</li>
<li class="fragment">Extract JSON data using <code>httr2::resp_body_json(simplifyVector = TRUE)</code> (or a similar function for different data types).</li>
<li class="fragment">Use <code>purrr::pluck()</code> to drill down to lower levels of nested lists.</li>
<li class="fragment"><span class="hl-lightblue-lightgreen"><strong><em>Build a function once you know how an API works!</em></strong></span></li>
</ul>
</section>
<section id="for-more-information" class="slide level2 inverse">
<h2>For More Information</h2>
<p>Useful Sources:</p>
<ul>
<li><a href="https://httr2.r-lib.org/index.html"><code>httr2</code> documentation</a> and the <a href="https://httr2.r-lib.org/articles/wrapping-apis.html">Wrapping APIs vignette</a></li>
</ul>
<p>Other Software:</p>
<ul>
<li><a href="https://www.postman.com/">Postman</a>: A purpose-built tool for accessing, developing, and testing APIs. Can provide a good workspace for figuring out different API options and settings. Available in Software Center.</li>
<li>Excel: Feels somewhat basic, but Excel does have good tools for pulling in data from APIs. The data can then be processed using the Power Query Editor. Can be useful when working with colleagues who are not well-versed in R or Python.</li>
</ul>
</section>
<section id="r-packages-for-apis" class="slide level2 inverse">
<h2>R Packages for APIs</h2>
<p>Already existing R packages wrapping useful APIs:</p>
<ul>
<li><a href="https://docs.ropensci.org/rnassqs/index.html"><code>rnassqs</code></a>: Accesses the NASS Quick Stats API (developed by Nicholas Potter of ERS)</li>
<li><a href="https://sboysel.github.io/fredr/index.html"><code>fredr</code></a>: Accesses the Federal Reserve Economic Data (FRED) API.</li>
<li><a href="https://www.hrecht.com/censusapi/"><code>censusapi</code></a>: Accesses the Census API, making more than 1,500 endpoints available.</li>
<li><a href="https://github.com/walkerke/tigris"><code>tigris</code></a>: Download Census Bureau TIGER/Line shapefiles.</li>
<li><a href="https://walker-data.com/tidycensus/index.html"><code>tidycensus</code></a>: Combines access to the Census API and TIGER/Line shapefiles to simultaneously pull Census data and geometries (at the cost of a more limited set of API endpoints).</li>
</ul>
</section></section>
<section id="thank-you" class="title-slide slide level1 inverse">
<h1>Thank You</h1>
<div style="position: absolute;top: 65%;margin-left: 1em;">
  <p style="margin-top: 12px;">Tristan Hanon</p>
  <p style="margin-top: 12px;">AMS Dairy Program</p>
  <a href="mailto:tristan.hanon@usda.gov" rel="noopener" style="margin-top: 12px;">
    <code>tristan.hanon@usda.gov</code>
  </a>
</div>


</section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<div class="footer footer-default">

</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="site_libs/revealjs/plugin/search/search.js"></script>
  <script src="site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: false,

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'fade',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1600,

        height: 900,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    

    <script>

      // htmlwidgets need to know to resize themselves when slides are shown/hidden.

      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current

      // slide changes (different for each slide format).

      (function () {

        // dispatch for htmlwidgets

        function fireSlideEnter() {

          const event = window.document.createEvent("Event");

          event.initEvent("slideenter", true, true);

          window.document.dispatchEvent(event);

        }

    

        function fireSlideChanged(previousSlide, currentSlide) {

          fireSlideEnter();

    

          // dispatch for shiny

          if (window.jQuery) {

            if (previousSlide) {

              window.jQuery(previousSlide).trigger("hidden");

            }

            if (currentSlide) {

              window.jQuery(currentSlide).trigger("shown");

            }

          }

        }

    

        // hookup for slidy

        if (window.w3c_slidy) {

          window.w3c_slidy.add_observer(function (slide_num) {

            // slide_num starts at position 1

            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);

          });

        }

    

      })();

    </script>

    

    <script id="quarto-html-after-body" type="application/javascript">
      window.document.addEventListener("DOMContentLoaded", function (event) {
        const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
        tabsets.forEach(function(tabset) {
          const tabby = new Tabby('#' + tabset.id);
        });
        const isCodeAnnotation = (el) => {
          for (const clz of el.classList) {
            if (clz.startsWith('code-annotation-')) {                     
              return true;
            }
          }
          return false;
        }
        const onCopySuccess = function(e) {
          // button target
          const button = e.trigger;
          // don't keep focus
          button.blur();
          // flash "checked"
          button.classList.add('code-copy-button-checked');
          var currentTitle = button.getAttribute("title");
          button.setAttribute("title", "Copied!");
          let tooltip;
          if (window.bootstrap) {
            button.setAttribute("data-bs-toggle", "tooltip");
            button.setAttribute("data-bs-placement", "left");
            button.setAttribute("data-bs-title", "Copied!");
            tooltip = new bootstrap.Tooltip(button, 
              { trigger: "manual", 
                customClass: "code-copy-button-tooltip",
                offset: [0, -8]});
            tooltip.show();    
          }
          setTimeout(function() {
            if (tooltip) {
              tooltip.hide();
              button.removeAttribute("data-bs-title");
              button.removeAttribute("data-bs-toggle");
              button.removeAttribute("data-bs-placement");
            }
            button.setAttribute("title", currentTitle);
            button.classList.remove('code-copy-button-checked');
          }, 1000);
          // clear code selection
          e.clearSelection();
        }
        const getTextToCopy = function(trigger) {
            const codeEl = trigger.previousElementSibling.cloneNode(true);
            for (const childEl of codeEl.children) {
              if (isCodeAnnotation(childEl)) {
                childEl.remove();
              }
            }
            return codeEl.innerText;
        }
        const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
          text: getTextToCopy
        });
        clipboard.on('success', onCopySuccess);
        if (window.document.getElementById('quarto-embedded-source-code-modal')) {
          const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
            text: getTextToCopy,
            container: window.document.getElementById('quarto-embedded-source-code-modal')
          });
          clipboardModal.on('success', onCopySuccess);
        }
          var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
          var mailtoRegex = new RegExp(/^mailto:/);
            var filterRegex = new RegExp("https:\/\/tmhanon\.github\.io\/DSTP-Using-APIs-With-R");
          var isInternal = (href) => {
              return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
          }
          // Inspect non-navigation links and adorn them if external
         var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
          for (var i=0; i<links.length; i++) {
            const link = links[i];
            if (!isInternal(link.href)) {
              // undo the damage that might have been done by quarto-nav.js in the case of
              // links that we want to consider external
              if (link.dataset.originalHref !== undefined) {
                link.href = link.dataset.originalHref;
              }
                // target, if specified
                link.setAttribute("target", "_blank");
                if (link.getAttribute("rel") === null) {
                  link.setAttribute("rel", "noopener");
                }
            }
          }
        function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
          const config = {
            allowHTML: true,
            maxWidth: 500,
            delay: 100,
            arrow: false,
            appendTo: function(el) {
                return el.closest('section.slide') || el.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'light-border',
            placement: 'bottom-start',
          };
          if (contentFn) {
            config.content = contentFn;
          }
          if (onTriggerFn) {
            config.onTrigger = onTriggerFn;
          }
          if (onUntriggerFn) {
            config.onUntrigger = onUntriggerFn;
          }
            config['offset'] = [0,0];
            config['maxWidth'] = 700;
          window.tippy(el, config); 
        }
        const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
        for (var i=0; i<noterefs.length; i++) {
          const ref = noterefs[i];
          tippyHover(ref, function() {
            // use id or data attribute instead here
            let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
            try { href = new URL(href).hash; } catch {}
            const id = href.replace(/^#\/?/, "");
            const note = window.document.getElementById(id);
            if (note) {
              return note.innerHTML;
            } else {
              return "";
            }
          });
        }
        const findCites = (el) => {
          const parentEl = el.parentElement;
          if (parentEl) {
            const cites = parentEl.dataset.cites;
            if (cites) {
              return {
                el,
                cites: cites.split(' ')
              };
            } else {
              return findCites(el.parentElement)
            }
          } else {
            return undefined;
          }
        };
        var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
        for (var i=0; i<bibliorefs.length; i++) {
          const ref = bibliorefs[i];
          const citeInfo = findCites(ref);
          if (citeInfo) {
            tippyHover(citeInfo.el, function() {
              var popup = window.document.createElement('div');
              citeInfo.cites.forEach(function(cite) {
                var citeDiv = window.document.createElement('div');
                citeDiv.classList.add('hanging-indent');
                citeDiv.classList.add('csl-entry');
                var biblioDiv = window.document.getElementById('ref-' + cite);
                if (biblioDiv) {
                  citeDiv.innerHTML = biblioDiv.innerHTML;
                }
                popup.appendChild(citeDiv);
              });
              return popup.innerHTML;
            });
          }
        }
      });
      </script>
    

</body></html>